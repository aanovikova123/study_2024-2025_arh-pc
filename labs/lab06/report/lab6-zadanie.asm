%include 'in_out.asm' ; подключение внешнего файла

SECTION .data ; секция инициированных данных
    msg: DB 'Введите значение переменной х: ', 0
    rem: DB 'Результат: ', 0

SECTION .bss ; секция неинициированных данных
    x: RESB 80 ; Переменная для ввода значения x, выделено 80 байт

SECTION .text ; Код программы
GLOBAL _start ; Начало программы
_start: ; Точка входа в программу

    ; ---- Запрос на ввод x
    mov eax, msg ; Загрузка адреса сообщения в eax
    call sprint ; Печать сообщения
    mov ecx, x ; Адрес переменной для хранения x
    mov edx, 80 ; Длина вводимого значения
    call sread ; Чтение значения x
    mov eax, x ; Загрузка адреса x в eax
    call atoi ; Преобразование ASCII в число, результат в eax

    ; ---- Вычисление выражения y = x^3 // 3 + 21
    mov ebx, eax ; Копируем x в ebx
    imul eax, eax ; eax = x^2
    imul eax, ebx ; eax = x^3
    mov ebx, 3 ; Делитель = 3
    xor edx, edx ; Очистка старшей части для деления
    div ebx ; eax = x^3 // 3, остаток игнорируется
    add eax, 21 ; eax = x^3 // 3 + 21
    mov edi, eax ; Сохраняем результат в edi

    ; ---- Вывод результата на экран
    mov eax, rem ; Загрузка сообщения 'Результат: ' в eax
    call sprint ; Печать сообщения
    mov eax, edi ; Загрузка результата в eax
    call iprintLF ; Печать результата в виде числа
    call quit ; Завершение программы
